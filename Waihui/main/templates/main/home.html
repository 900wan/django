{% extends "main/base.html" %}
{% load i18n %} 
{% load tz %}
{% get_current_language as LANGUAGE_CODE %}
{% get_current_timezone as TIME_ZONE %}

{% block title %}
    Home
{% endblock title %}

{% block content %}
    <h1>{{heading}}</h1>
    {% trans "This the content of home page." %}
    <h1>{% trans "User"%}</h1>
    {% if info.is_login %}
        <h2>* User profile</h2>
            <ul style="font-family:monospace;">
                <li>login name: {{info.current_user.get_username}}</li>
                <li>email: {{info.current_user.email}}</li>
                <li>last login: {{info.current_user.last_login|date:"Y-m-d H:i:s (O)"}}</li>
                <li><a href="{% url 'main:dashboard' %}">go to dashboard to see my full profile and courses...</a></li>
            </ul>
    {% else %}
        {% trans "You have not loged in." %}

    {% endif %}
    <h1>{% trans "Local" %}</h1>
    <h2>* Language</h2>
    {% trans "The priority languageï¼š" %}{{ LANGUAGE_CODE|language_name_local }}. (
    {{ LANGUAGE_CODE }}, 
    {{ LANGUAGE_CODE|language_name_local }}, 
    {{ LANGUAGE_CODE|language_name }}, 
    {{ LANGUAGE_CODE|language_bidi }}) <br>
    {% trans "This is our first auto-translation page." %}
    <h2>* Time zone</h2>
        Time zone using in this page: {{TIME_ZONE}}
        <ul style="text-align:right; width:280px;font-family:monospace;">
            {% localtime off %}
            <li>Server: {{now_tz|date:"Y-m-d H:i:s (O)"}}</li>
            {% endlocaltime %}
            <li>Beijing : {{now_tz|timezone:"Asia/Shanghai"|date:"d H:i:s (O)"}}</li>
            <li>Los Angeles : {{now_tz|timezone:"America/Los_Angeles"|date:"d H:i:s (O)"}}</li>
            <li>Chicago : {{now_tz|timezone:"America/Chicago"|date:"d H:i:s (O)"}}</li>
            <li>New York : {{now_tz|timezone:"America/New_York"|date:"d H:i:s (O)"}}</li>
            <li>London : {{now_tz|timezone:"Europe/London"|date:"d H:i:s (O)"}}</li>
            <li>Paris : {{now_tz|timezone:"Europe/Paris"|date:"d H:i:s (O)"}}</li>
        </ul>

    
    <h1>{% trans "Pages" %}</h1>
    <p>{% trans "link to other pages" %}</p>
    <h2>* {% trans "Sitemap" %}</h2>
    {# <a href="{% url 'main:index' %}">{% trans "Show Index" %}</a> #}
    {# <a href="{% url 'main:user' %}">{% trans "Show Users" %}</a> #}
    {# <a href="{% url 'main:topic_category'%}">{% trans "Show Topic category" %}</a> #}
    {# <a href="{% url 'main:tutor' %}">{% trans "Show tutortor" %}</a> #}
    <table>
        <thead>
            <tr>
                <td>Pages</td>
                <td>Actions</td>
            </tr>
            <tr>
                <td></td>
                <td>Buyer</td>
                <td>Provider</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><a href="{% url 'main:skulist' %}">{% trans "SKU List" %}</a></td>
                <td><a href="{% url 'main:picktopic' %}">{% trans "Book a course" %}</a></td>
                {% if info.is_provider %}
                    <td><a href="{% url 'main:addsku' %}">{% trans "Add one SKU (for provider)" %}</a></td>
                {% endif %}
            </tr>
            <tr>
                <td></td>
                <td><a href="{% url 'main:addorder' %}">{% trans "Add Order" %}</a></td>
                {% if info.is_provider %}
                    <td><a href="{% url 'main:schedule' %}">{% trans "Schedule (for provider)" %}</a></td>
                {% endif %}
            </tr>
        </tbody>

    </table>

    <ul>
        {# <li><a href="{% url 'main:dashboard' %}">{% trans "Dashboard for student" %}</a></li> #}
        {# <li><a href="{% url 'main:office' %}">{% trans "Office for tutor" %}</a></li> #}
            <li><a href="{% url 'main:skulist' %}">{% trans "SKU List" %}</a></li>
        {% if info.is_provider %}
            <li><a href="{% url 'main:picktopic' %}">{% trans "Book a course" %}</a></li>
            <li><a href="{% url 'main:addsku' %}">{% trans "Add one SKU (for provider)" %}</a></li>
            <li><a href="{% url 'main:schedule' %}">{% trans "Schedule (for provider)" %}</a></li>
        {% else %}
            <li><a href="{% url 'main:picktopic' %}">{% trans "Book a course" %}</a></li>
        {% endif %}
        <li><a href="{% url 'main:addorder' %}">{% trans "Add Order" %}</a></li>
    </ul>
    {% if info.is_login %}
    <h2>* {% trans "Learn Courses" %}</h2>
    <strong>As a student</strong>, you have {{info.current_user.buyer.sku_set.all|length}} courses and {{info.current_user.buyer.order_set.all|length}} <a href="{% url 'main:orderlist' %}">orders</a>
    <table>
            <thead>
                <tr>
                    <th>Topic</th>
                    <th>Timeflag</th>
                    <th>ID</th>
                    <th>Provider</th>
                    <th>status</th>
                    <th>Has plan?</th>
                    <th>Buyer</th>
                    <th>Start time</th>
                    <th>End time</th>
                    <th>Created</th>
                    <th>Modified</th>
                    <th>OP</th>
                </tr>
            </thead>
            <tbody>
                {% for sku in skus|dictsortreversed:"start_time" %}
                <tr>
                    <td><a href="{% url 'main:showsku' sku.id %}">{{sku.topic}}</a></td>
                    <td>
                        {% if sku.is_start_later %}
                            waiting...
                        {% elif sku.is_start_soon %}
                            <strong>SOON-countdown: <br/ >{{sku.time_to_start}}</strong>
                        {% elif sku.is_should_in_progress%}
                            NOW
                        {% elif sku.is_past%}
                            past
                        {% endif %}
                    </td>
                    <td>{{sku.id}}</td>
                    <td>{{sku.provider}}</td>
                    <td>{{sku.status}}({{sku.get_status_display}})</td>
                    <td>
                        {% if sku.has_plan %}
                            yes
                        {% else %}
                            <strong>NO</strong>
                        {% endif %}
                    </td>
                    <td>{{sku.buyer.all|safeseq|join:", "}}</td>
                    <td>{{sku.start_time|date:"Y-m-d H:i (e)"}}</td>
                    <td>{{sku.end_time|date:"Y-m-d H:i (e)"}}</td>
                    <td>{{sku.created|date:"Y-m-d H:i (e)"}}</td>
                    <td>{{sku.modified|date:"Y-m-d H:i (e)"}}</td>
                    <td><a href="{% url 'main:buyer_cancel_sku' sku.id %}">[CANCEL]</a>
                    {% if sku.has_plan and sku.status == 6 and not sku.is_past %}
                        <strong><a href="{% url 'main:buyer_ready_sku' sku.id%}">[Ready!]</a></strong>
                    {% elif sku.status == 7 and not sku.is_past %}
                        <strong><a href="{% url 'main:showsku' sku.id %}">[ENTER!]</a></strong>
                    {% endif %}
                    </td>
                </tr>
                {% endfor%}
            </tbody>
        </table>
        <a href="{% url 'main:dashboard' %} ">More...</a>
    {% endif %}
{% endblock content %}